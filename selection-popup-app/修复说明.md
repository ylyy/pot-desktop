# 🔧 v2.0.1 修复说明

## 错误描述

在 v2.0.0 版本中，应用启动时会出现以下错误：
```
Error: globalShortcut cannot be used before the app is ready
```

## 错误原因

1. **globalShortcut 过早调用**：在 `app.on('will-quit')` 事件处理中直接调用了 `globalShortcut.unregisterAll()`，但此事件注册时应用还未准备就绪。

2. **ConfigStore 初始化问题**：在应用启动时立即创建 ConfigStore 实例，可能会在 app 准备就绪前调用 `app.getPath('userData')`。

## 修复内容

### 1. 修复 globalShortcut 调用时机
```javascript
// 修复前
app.on('will-quit', () => {
    globalShortcut.unregisterAll();  // 错误：可能在app未ready时调用
});

// 修复后
app.on('will-quit', () => {
    if (app.isReady()) {  // 添加检查
        globalShortcut.unregisterAll();
    }
});
```

### 2. 修复 ConfigStore 初始化
```javascript
// 修复：添加 try-catch 处理
constructor() {
    try {
        const userDataPath = app.getPath('userData');
        this.path = path.join(userDataPath, 'config.json');
    } catch (e) {
        // 使用临时路径
        this.path = path.join(process.cwd(), 'config.json');
    }
}
```

### 3. 调整代码执行顺序
将 `app.on('will-quit')` 和其他事件处理程序的注册移到了正确的位置。

## 临时解决方案

如果您已经下载了 v2.0.0 版本，可以：

1. **等待修复版**：下载 v2.0.1 修复版
2. **手动修复**：
   - 解压应用
   - 找到 `resources/app.asar`
   - 使用 asar 工具解压并修改代码
   - 重新打包

## 版本历史

- **v2.0.0**：初始版本（存在启动错误）
- **v2.0.1**：修复启动错误

## 下载修复版

修复版文件：`AI划词助手-v2.0.1-修复版.7z`

## 注意事项

1. 修复版完全兼容 v2.0.0 的配置文件
2. 无需重新设置 API Key 和自定义按钮
3. 建议完全卸载旧版本后安装新版本