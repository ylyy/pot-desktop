# ğŸ”§ v2.2.1 ä¿®å¤è¯´æ˜

## é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆv2.2.0ç‰ˆæœ¬å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
1. æ™ºèƒ½åˆ’è¯åŠŸèƒ½ä»éœ€è¦æ‰‹åŠ¨æŒ‰Ctrl+Cæ‰èƒ½è§¦å‘
2. Dify APIè°ƒç”¨æ—¶æ‰€æœ‰æŒ‰é’®éƒ½è¿”å›"å¤„ç†å®Œæˆ"ï¼Œæ²¡æœ‰å®é™…å†…å®¹

## ä¿®å¤å†…å®¹

### 1. æ™ºèƒ½åˆ’è¯æ£€æµ‹ä¼˜åŒ–
- **é—®é¢˜åŸå› **ï¼šåŸå®ç°ç­‰å¾…ç”¨æˆ·æ‰‹åŠ¨è§¦å‘å¤åˆ¶æ“ä½œ
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - æ”¹ä¸ºä¸»åŠ¨å®šæ—¶æ£€æµ‹ï¼ˆæ¯500msï¼‰
  - è‡ªåŠ¨æ¸…ç©ºå‰ªè´´æ¿å¹¶æ¨¡æ‹Ÿå¤åˆ¶æ“ä½œ
  - æ™ºèƒ½åˆ¤æ–­æ˜¯å¦æœ‰æ–°æ–‡æœ¬è¢«é€‰ä¸­
  - æ·»åŠ é˜²æŠ–æœºåˆ¶é¿å…é‡å¤è§¦å‘

### 2. Dify API æµå¼å“åº”ä¿®å¤
æ ¹æ®ç”¨æˆ·åé¦ˆçš„å…³é”®æ”¹åŠ¨ï¼š
- **è‡ªåŠ¨åè®®é€‰æ‹©**ï¼šæ ¹æ®URLè‡ªåŠ¨é€‰æ‹©http/httpså®¢æˆ·ç«¯
- **é”™è¯¯å¤„ç†ä¼˜åŒ–**ï¼š
  - é2xxçŠ¶æ€ç ç«‹å³è¯»å–é”™è¯¯ä½“å¹¶å¿«é€Ÿå¤±è´¥
  - ä¾¿äºå®šä½é‰´æƒ/ç½‘å…³é”™è¯¯
- **æ•°æ®è§£ææ”¹è¿›**ï¼š
  - ä½¿ç”¨ç¼“å†²åŒºé€è¡Œè§£æSSEäº‹ä»¶
  - å…¼å®¹åªå«answeræˆ–å«[DONE]çš„æƒ…å†µ
  - æ­£ç¡®å¤„ç†messageå’Œmessage_endäº‹ä»¶
- **æŸ¥è¯¢æ–‡æœ¬å¤„ç†**ï¼šä½¿ç”¨promptï¼ˆå¦‚æœæœ‰ï¼‰è€Œä¸æ˜¯åŸå§‹text

## æŠ€æœ¯ç»†èŠ‚

### æ™ºèƒ½åˆ’è¯å®ç°
```javascript
// æ¯500msæ£€æµ‹ä¸€æ¬¡
setInterval(() => {
    // 1. ä¿å­˜å½“å‰å‰ªè´´æ¿
    const oldClipboard = clipboard.readText();
    
    // 2. æ¸…ç©ºå‰ªè´´æ¿
    clipboard.clear();
    
    // 3. æ¨¡æ‹Ÿå¤åˆ¶æ“ä½œ
    robot.keyTap('c', 'control');
    
    // 4. æ£€æŸ¥æ˜¯å¦æœ‰æ–°æ–‡æœ¬
    const selectedText = clipboard.readText();
    
    // 5. æ¢å¤åŸå‰ªè´´æ¿
    clipboard.writeText(oldClipboard);
    
    // 6. å¦‚æœæœ‰æ–°æ–‡æœ¬ï¼Œæ˜¾ç¤ºAIæŒ‰é’®
    if (selectedText && selectedText !== lastSelectedText) {
        showFloatingWindow(mousePos, selectedText);
    }
}, 500);
```

### Dify API ä¿®å¤
```javascript
// è‡ªåŠ¨é€‰æ‹©åè®®
const protocol = parsedUrl.protocol === 'https:' ? https : http;

// é”™è¯¯å¿«é€Ÿå¤±è´¥
if (res.statusCode < 200 || res.statusCode >= 300) {
    let errorBody = '';
    res.on('data', chunk => errorBody += chunk);
    res.on('end', () => {
        reject(new Error(`APIè¯·æ±‚å¤±è´¥ (${res.statusCode}): ${errorBody}`));
    });
    return;
}

// ä½¿ç”¨promptè€Œä¸æ˜¯text
const queryText = data.prompt || data.text;
```

## æµ‹è¯•å»ºè®®

1. **æ™ºèƒ½åˆ’è¯æµ‹è¯•**ï¼š
   - åœ¨ä¸åŒåº”ç”¨ä¸­é€‰ä¸­æ–‡æœ¬
   - æ— éœ€æŒ‰ä»»ä½•é”®ï¼ŒAIæŒ‰é’®åº”è‡ªåŠ¨å‡ºç°
   - éªŒè¯å‰ªè´´æ¿å†…å®¹æœªè¢«æ”¹å˜

2. **Dify APIæµ‹è¯•**ï¼š
   - é…ç½®æ­£ç¡®çš„API Key
   - æµ‹è¯•å„ä¸ªåŠŸèƒ½æŒ‰é’®ï¼ˆç¿»è¯‘ã€è§£é‡Šã€æ€»ç»“ç­‰ï¼‰
   - éªŒè¯æµå¼å“åº”å®æ—¶æ˜¾ç¤º

## ç‰ˆæœ¬ä¿¡æ¯

- ç‰ˆæœ¬å·ï¼šv2.2.1
- å‘å¸ƒæ—¥æœŸï¼š2024-08-08
- ä¿®å¤å†…å®¹ï¼šæ™ºèƒ½åˆ’è¯æ£€æµ‹ã€Dify APIæµå¼å“åº”