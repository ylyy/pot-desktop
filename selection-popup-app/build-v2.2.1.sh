#!/bin/bash

echo "==========================================="
echo "AI划词助手 v2.2.1 - 修复版打包脚本"
echo "==========================================="

# 更新版本号
sed -i 's/"version": "2.2.0"/"version": "2.2.1"/' package.json

echo ""
echo "1. 清理旧的打包文件..."
echo "-----------------------------------"
rm -rf dist/

echo ""
echo "2. 重新打包应用..."
echo "-----------------------------------"
npm run dist:win

echo ""
echo "3. 创建v2.2.1版压缩包..."
echo "-----------------------------------"
7z a -t7z -mx=9 "AI划词助手-v2.2.1-修复版.7z" dist/win-unpacked/*

echo ""
echo "==========================================="
echo "v2.2.1 修复版打包完成！"
echo "==========================================="
echo ""
echo "🔧 修复内容："
echo "- 智能划词无需手动按Ctrl+C"
echo "- Dify API正确返回AI处理结果"
echo "- 优化错误处理和流式响应"
echo ""
echo "输出文件："
echo "- AI划词助手-v2.2.1-修复版.7z"
echo ""