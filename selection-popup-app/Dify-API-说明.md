# 🚀 Dify API 流式响应配置说明

## 概述

AI划词助手 v2.1 新增了对 Dify API 的支持，支持流式响应，可以实时显示AI的回复内容，提供更好的用户体验。

## 配置步骤

### 1. 打开设置页面
- 右键系统托盘图标
- 选择"设置"

### 2. 进入 API 设置
- 点击左侧"API设置"
- 选择"Dify API"标签页

### 3. 配置 API 参数

**API地址**：
```
http://aifoundry.unisoc.com:8099/v1/chat-messages
```

**API Key**：
- 输入您的 API Key（不需要 "Bearer " 前缀）
- 系统会自动添加 Bearer 认证头

### 4. 保存设置
- 点击"保存设置"
- 点击"测试连接"验证配置

## 功能特点

### 🌊 流式响应
- 实时显示AI回复内容
- 逐字显示，流畅自然
- 自动滚动到最新内容

### 📝 支持的功能
- 翻译
- 解释
- 总结
- 改写
- 语法检查
- 自定义功能按钮

## API 请求格式

系统会自动构建符合 Dify API 规范的请求：

```json
{
  "inputs": {},
  "query": "用户选中的文本",
  "response_mode": "streaming",
  "conversation_id": "",
  "user": "user-时间戳",
  "files": []
}
```

## 响应处理

系统会自动解析 SSE（Server-Sent Events）格式的流式响应：

```
data: {"event": "message", "answer": "回复内容片段"}
data: {"event": "message_end", "metadata": {...}}
```

## 注意事项

1. **网络要求**：
   - 确保能访问 API 地址
   - 内网环境可能需要配置代理

2. **API Key 安全**：
   - API Key 保存在本地配置文件
   - 不会上传到任何第三方服务

3. **性能优化**：
   - 流式响应减少等待时间
   - 实时反馈提升用户体验

## 故障排除

### 问题：连接失败
- 检查 API 地址是否正确
- 验证 API Key 是否有效
- 确认网络连接正常

### 问题：无响应
- 查看是否选择了"Dify API"作为当前提供商
- 检查文本长度是否超过限制

### 问题：乱码
- 确保 API 返回的是 UTF-8 编码
- 检查响应格式是否符合 SSE 标准

## 自定义 API 流式响应

如果您有其他支持 SSE 的 API，可以使用"自定义API"选项：

1. 选择"自定义API"标签
2. 填写 API 地址
3. 配置请求头（JSON格式）
4. 勾选"启用流式响应"
5. 设置请求体模板

## 更新日志

### v2.1.0
- ✨ 新增 Dify API 支持
- ✨ 实现流式响应显示
- 🔧 优化结果窗口体验
- 🔧 修复滚动定位问题